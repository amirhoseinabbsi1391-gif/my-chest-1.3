<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>

<style>
body{
  font-family:tahoma;
  background:#0f172a;
  color:#fff;
  padding:20px
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px
}
th,td{
  border:1px solid #334155;
  padding:8px;
  text-align:center
}
button{
  padding:5px 10px;
  margin:2px;
  cursor:pointer
}
.block{background:#dc2626;color:#fff}
.unblock{background:#16a34a;color:#fff}
</style>
</head>

<body>

<h2>ğŸ“Š Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
<p id="stats"></p>

<table id="table">
<tr>
  <th>Ù†Ø§Ù…</th>
  <th>Ø§ÛŒÙ…ÛŒÙ„</th>
  <th>ÙˆØ¶Ø¹ÛŒØª</th>
  <th>Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª</th>
  <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
</tr>
</table>

<script>
// ğŸ”¹ Ù„ÛŒÙ†Ú© Web App Ú¯ÙˆÚ¯Ù„
const API = "https://script.google.com/macros/s/AKfycbx70gzeQLPX5Zuono5hq-XzImGmjiWpnvRXJUJTq5dfySY6xrGbRFHKtQ7r3EXefuqd/exec";

// ğŸ”¹ Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
function loadUsers(){
  fetch(API)
    .then(res => res.json())
    .then(users => {

      const table = document.getElementById("table");
      table.innerHTML = `
        <tr>
          <th>Ù†Ø§Ù…</th>
          <th>Ø§ÛŒÙ…ÛŒÙ„</th>
          <th>ÙˆØ¶Ø¹ÛŒØª</th>
          <th>Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>`;

      // ğŸ”¸ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
      let total = users.length;
      let blocked = users.filter(u => u.blocked).length;

      document.getElementById("stats").innerText =
        `Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ${total} | ÙØ¹Ø§Ù„: ${total-blocked} | Ù…Ø³Ø¯ÙˆØ¯: ${blocked}`;

      // ğŸ”¸ Ù†Ù…Ø§ÛŒØ´ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±
      users.forEach(u => {
        const tr = table.insertRow();
        tr.insertCell(0).innerText = u.name;
        tr.insertCell(1).innerText = u.email;
        tr.insertCell(2).innerText = u.blocked ? "Ù…Ø³Ø¯ÙˆØ¯" : "ÙØ¹Ø§Ù„";
        tr.insertCell(3).innerText = u.lastActivity || "-";

        const actions = tr.insertCell(4);

        // ğŸ”¹ Ø¯Ú©Ù…Ù‡ Ø¨Ù„Ø§Ú© / Ø¢Ù†â€ŒØ¨Ù„Ø§Ú©
        const btn = document.createElement("button");
        btn.innerText = u.blocked ? "Ø¢Ù†â€ŒØ¨Ù„Ø§Ú©" : "Ø¨Ù„Ø§Ú©";
        btn.className = u.blocked ? "unblock" : "block";
        btn.onclick = () => toggleBlock(u.row, !u.blocked);
        actions.appendChild(btn);

        // ğŸ”¹ Ø¯Ú©Ù…Ù‡ Ø­Ø°Ù
        const del = document.createElement("button");
        del.innerText = "Ø­Ø°Ù";
        del.onclick = () => deleteUser(u.row);
        actions.appendChild(del);
      });
    });
}

// ğŸ”¹ Ø¨Ù„Ø§Ú© ÛŒØ§ Ø¢Ù†â€ŒØ¨Ù„Ø§Ú© Ú©Ø§Ø±Ø¨Ø±
function toggleBlock(row, value){
  fetch(API,{
    method:"PUT",
    body:JSON.stringify({
      row: row,
      column: 4,   // Ø³ØªÙˆÙ† blocked
      value: value
    })
  }).then(loadUsers);
}

// ğŸ”¹ Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±
function deleteUser(row){
  if(!confirm("Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø­Ø°Ù Ø´ÙˆØ¯ØŸ")) return;

  fetch(API,{
    method:"PUT",
    body:JSON.stringify({
      action:"delete",
      row: row
    })
  }).then(loadUsers);
}

// ğŸ”¹ Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
loadUsers();
</script>

</body>
</html>





